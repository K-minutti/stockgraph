{% extends "layout.html" %} {% block content%}
<div id="study" class="grid-container">
  <div class="study-input-form-container">
    <form class="study-input-form">
      <label for="ticker-input">Symbol:</label>
      <input
        id="ticker-input"
        name="ticker-input"
        type="text"
        placeholder="Type a stock symbol and hit enter to analyze..."
        onkeydown="searchInputTicker(event)"
      />
    </form>
  </div>

  <!-- TradingView Widget BEGIN -->
  <!--
<div class="tradingview-widget-container">
  <script
    type="text/javascript"
    src="https://s3.tradingview.com/tv.js"
  ></script>
  <script type="text/javascript">
    new TradingView.widget({
      width: "100%",
      height: 620,
      symbol: "NASDAQ:AAPL",
      timezone: "Etc/UTC",
      theme: "light",
      style: "1",
      locale: "en",
      toolbar_bg: "#f1f3f6",
      enable_publishing: false,
      withdateranges: true,
      range: "60M",
      hide_side_toolbar: false,
      allow_symbol_change: true,
      studies: ["Volume@tv-basicstudies"],
      show_popup_button: true,
      popup_width: "1000",
      popup_height: "650",
      container_id: "tradingview_343f6",
    });
  </script>
</div>
-->
  <!-- TradingView Widget END -->
  <div class="study-tabs-container row">
    <div class="tabs row">
      <p id="tab-Chart" class="active-tab" onclick="changeTab(event)">Chart</p>
      <p id="tab-Performance" onclick="changeTab(event)">Performance</p>
      <p id="tab-Seasonality" onclick="changeTab(event)">Seasonality</p>
      <p id="tab-Volatility" onclick="changeTab(event)">Volatility</p>
      <p id="tab-Volume" onclick="changeTab(event)">Volume</p>
    </div>
  </div>

  <div class="main-study-container">
    <div id="section-Chart" class="active-section">
      <p>ENTER A TICKER TO VIEW A CHART</p>
    </div>
    <div id="section-Performance" class="section">
      <p>ENTER A TICKER TO VIEW PERFORMANCE</p>
    </div>
    <div id="section-Seasonality" class="section">
      <p>ENTER A TICKER TO VIEW SEASONALITY</p>
    </div>
    <div id="section-Volatility" class="section">
      <p>ENTER A TICKER TO VIEW VOLATILITY</p>
    </div>
    <div id="section-Volume" class="section">
      <p>ENTER A TICKER TO VIEW VOLUME ANALYSIS</p>
    </div>
  </div>
</div>
<!-- TradingView Widget BEGIN -->
<!--
<div class="tradingview-widget-container">
  <div class="tradingview-widget-container__widget"></div>
  <div class="tradingview-widget-copyright">
    <a
      href="https://www.tradingview.com/symbols/NASDAQ-AAPL/history-timeline/"
      rel="noopener"
      target="_blank"
      ><span class="blue-text">AAPL History</span></a
    >
    by TradingView
  </div>
  <script
    type="text/javascript"
    src="https://s3.tradingview.com/external-embedding/embed-widget-timeline.js"
    async
  >
      {
      "symbol": "NASDAQ:AAPL",
      "colorTheme": "light",
      "isTransparent": false,
      "largeChartUrl": "",
      "displayMode": "regular",
      "width": "100%",
      "height": 830,
      "locale": "en"
    }
  </script>
</div>
-->
<!-- TradingView Widget END -->

<script>
  /*
  if symbol is valid
  return the correct chart and timeline
  and return the correct stats
  stats ---> 
  seasonality? sector basket performance
  
  so lets see we have to split resources
  and functionlity. 

  when I go to study I want to be able to add a ticker and see nothing
  for the time being except for a folio container with multiple tabs
  */
  async function searchInputTicker(e) {
    if (e.keyCode === 13) {
      e.preventDefault();
      let text = e.target.value;
      let queryStr = text.trim().replace("?", "");
      let finalQueryText = queryStr.toUpperCase();

      const res = await fetch(
        `http://127.0.0.1:8000/search-symbol/${finalQueryText}`
      );

      const result = await res.json();
      if (result["valid_symbol"]) {
        alert(finalQueryText);
      } else {
        alert("NOT A VALID SYMBOL. SORRY!");
      }
    }
  }

  function changeTab(e) {
    document.getElementsByClassName("active-tab")[0].className = "";
    document.getElementsByClassName("active-section")[0].className = "section";
    let id = e.target.innerText;
    let tabId = `tab-${id}`;
    let sectionId = `section-${id}`;
    document.getElementById(tabId).className = "active-tab";
    document.getElementById(sectionId).className = "active-section";
  }
</script>
{% endblock%}
