{% extends "layout.html" %} {% block content%}
<div id="home" class="grid-container">
  <div class="home-item-1 blue-s">
    <div class="grid-item-container">
      <div class="item-header row">
        <p>Gainers/Decliners</p>
      </div>
      <div class="item-main-content market-internals-container">
        <canvas id="myChart" height="200px"></canvas>
      </div>
    </div>
  </div>

  <div class="home-item-2 blue-s">
    <div class="grid-item-container">
      <div class="item-header row index-header">
        <div class="row"><i class="fas fa-circle orange dot"></i>SPY</div>
        <div class="row"><i class="fas fa-circle blue dot"></i>QQQ</div>
        <div class="row"><i class="fas fa-circle violet dot"></i>DJI</div>
        <div class="row"><i class="fas fa-circle green dot"></i>IWM</div>
        <div class="row"><i class="fas fa-circle ice dot"></i>VIXY</div>
      </div>
      <div class="item-main-content">
        <div id="main-home-chart"></div>
      </div>
    </div>
  </div>
  <div class="home-item-3 blue-s">
    <div class="grid-item-container">
      <div class="item-header row">
        <p>Market Internals</p>
      </div>
      <div class="item-main-content">
        <table>
          <thead>
            <div class="table-headers-row">
              <tr>
                <th>Symbol</th>
                <th>Change %</th>
                <th>Symbol</th>
                <th>Change %</th>
              </tr>
            </div>
          </thead>
          <tbody>
            {% for stock in top_stocks%}
            <tr>
              <td>{{stock[0].symbol}}</td>
              <td class="color-up">{{stock[0].change}}</td>
              <td class="tbody-left-border">{{stock[1].symbol}}</td>
              <td class="color-down">{{stock[1].change}}</td>
            </tr>
            {% endfor%}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="home-item-4 blue-s">
    <div class="grid-item-container home-table">
      <div class="item-header row">
        <p>Market News</p>
      </div>

      <div class="item-main-content table-container">
        <table>
          <thead>
            <div class="table-headers-row">
              <tr>
                <th>Date</th>
                <th>Time</th>
                <th>Headline</th>
              </tr>
            </div>
          </thead>
          <tbody>
            {% for item in news%}
            <tr>
              <td class="nowrap">{{item.date}}</td>
              <td class="tbody-left-border">{{item.time}}</td>
              <td class="tbody-left-border">
                <a href="{{item.link}}" target="_blank">{{item.title}}</a>
              </td>
            </tr>
            {% endfor%}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="home-item-5 blue-s">
    <div class="grid-item-container home-table">
      <div class="item-header row">
        <p>Trending Searches</p>
      </div>
      <div class="item-main-content table-container">
        <table>
          <thead>
            <div class="table-headers-row">
              <tr>
                <th>No.</th>
                <th>Item</th>
              </tr>
            </div>
          </thead>
          <tbody>
            {% for trend in g_trends%}
            <tr>
              <td>{{trend.count}}</td>
              <td class="tbody-left-border nowrap">{{trend.item}}</td>
            </tr>
            {% endfor%}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <script>
    function getSize() {
      let element = document.getElementById("main-home-chart");
      const style = window.getComputedStyle(element);
      let h = style.height.length - 2;
      let height = parseInt(style.height.slice(0, h));
      let w = style.height.length - 2;
      let width = parseInt(style.width.slice(0, w));
      return { height: height, width: width };
    }

    function makeChart() {
      size = getSize();
      const element = document.getElementById("main-home-chart");
      const chart = LightweightCharts.createChart(element, {
        width: size.width,
        height: size.height,
        rightPriceScale: {
          scaleMargins: {
            top: 0.1,
            bottom: 0.1,
          },
          mode: LightweightCharts.PriceScaleMode.Percentage,
          borderColor: "rgba(197, 203, 206, 0.4)",
        },
        layout: {
          backgroundColor: "#00000000",
          textColor: "#fff",
        },

        crosshair: {
          vertLine: {
            width: 4,
            color: "rgba(224, 227, 235, 0.1)",
            style: 0,
          },
          horzLine: {
            visible: false,
            labelVisible: false,
          },
        },
        grid: {
          vertLines: {
            visible: false,
          },
          horzLines: {
            color: "rgba(42, 46, 57, 0.5)",
          },
        },
      });

      const areaSeries1 = chart.addAreaSeries({
        topColor: "rgba(235, 100, 4, 0.15)",
        bottomColor: "rgba(235, 100, 4, 0.01)",
        lineColor: "rgba(235, 100, 4, 1)",
        lineWidth: 3,
      });
      areaSeries1.setData([
        { time: "2019-04-11", value: 120.01 },
        { time: "2019-04-12", value: 76.63 },
        { time: "2019-04-13", value: 76.64 },
        { time: "2019-04-14", value: 61.89 },
        { time: "2019-04-15", value: 54.43 },
        { time: "2019-04-16", value: 70.01 },
        { time: "2019-04-17", value: 86.63 },
        { time: "2019-04-18", value: 86.64 },
        { time: "2019-04-19", value: 101.89 },
        { time: "2019-04-20", value: 107.43 },
      ]);

      const areaSeries2 = chart.addAreaSeries({
        topColor: "rgba(26, 169, 255, 0.15)",
        bottomColor: "rgba(26, 169, 255, 0.01)",
        lineColor: "rgba(26, 169, 255, 1)",
        lineWidth: 3,
      });
      areaSeries2.setData([
        { time: "2019-04-11", value: 110.01 },
        { time: "2019-04-12", value: 96.63 },
        { time: "2019-04-13", value: 86.64 },
        { time: "2019-04-14", value: 66.89 },
        { time: "2019-04-15", value: 59.43 },
        { time: "2019-04-16", value: 67.01 },
        { time: "2019-04-17", value: 77.63 },
        { time: "2019-04-18", value: 80.64 },
        { time: "2019-04-19", value: 91.89 },
        { time: "2019-04-20", value: 97.43 },
      ]);

      const areaSeries3 = chart.addAreaSeries({
        topColor: "rgba(177, 99, 255, 0.15)",
        bottomColor: "rgba(177, 99, 255, 0.01)",
        lineColor: "rgba(177, 99, 255, 1)",
        lineWidth: 3,
      });
      areaSeries3.setData([
        { time: "2019-04-11", value: 115.01 },
        { time: "2019-04-12", value: 90.63 },
        { time: "2019-04-13", value: 86.64 },
        { time: "2019-04-14", value: 96.89 },
        { time: "2019-04-15", value: 100.43 },
        { time: "2019-04-16", value: 97.01 },
        { time: "2019-04-17", value: 97.63 },
        { time: "2019-04-18", value: 100.64 },
        { time: "2019-04-19", value: 103.89 },
        { time: "2019-04-20", value: 107.43 },
      ]);

      const areaSeries4 = chart.addAreaSeries({
        topColor: "rgba(51, 225, 144, 0.15)",
        bottomColor: "rgba(51, 225, 144, 0.01)",
        lineColor: "rgba(51, 225, 144, 1)",
        lineWidth: 3,
      });
      areaSeries4.setData([
        { time: "2019-04-11", value: 80.01 },
        { time: "2019-04-12", value: 96.63 },
        { time: "2019-04-13", value: 76.64 },
        { time: "2019-04-14", value: 81.89 },
        { time: "2019-04-15", value: 74.43 },
        { time: "2019-04-16", value: 80.01 },
        { time: "2019-04-17", value: 96.63 },
        { time: "2019-04-18", value: 76.64 },
        { time: "2019-04-19", value: 81.89 },
        { time: "2019-04-20", value: 74.43 },
      ]);

      const areaSeries5 = chart.addAreaSeries({
        topColor: "rgba(140, 160, 214, 0.15)",
        bottomColor: "rgba(140, 160, 214, 0.01)",
        lineColor: "rgba(140, 160, 214, 1)",
        lineWidth: 3,
      });
      areaSeries5.setData([
        { time: "2019-04-11", value: 40.01 },
        { time: "2019-04-12", value: 36.63 },
        { time: "2019-04-13", value: 46.64 },
        { time: "2019-04-14", value: 31.89 },
        { time: "2019-04-15", value: 44.43 },
        { time: "2019-04-16", value: 30.01 },
        { time: "2019-04-17", value: 36.63 },
        { time: "2019-04-18", value: 36.64 },
        { time: "2019-04-19", value: 31.89 },
        { time: "2019-04-20", value: 34.43 },
      ]);

      chart.timeScale().fitContent();
      return chart;
    }
    chart = makeChart();
  </script>
  {% block javascript %}
  <script>
    //get rid of background grid and legend,make text color white

    Chart.defaults.plugins.legend.display = false;
    Chart.defaults.color = "#fff";

    var ctx = document.getElementById("myChart").getContext("2d");

    var myChart = new Chart(ctx, {
      type: "bar",
      data: {
        labels: ["advance", "neutral", "decline"],
        datasets: [
          {
            label: "stocks",
            barThickness: 18,
            data: {{ ad_data }},
            backgroundColor: [
              "rgba(0, 137, 123, 0.12)",
              "rgba(209, 212, 220, 0.12)",
              "rgba(229, 57, 53, 0.12)",
            ],
            borderColor: [
              "rgba(0, 137, 123, 1)",
              "rgba(209, 212, 220, 1)",
              "rgba(229, 57, 53, 1)",
            ],
            borderWidth: 3,
          },
        ],
      },
      options: {
        scales: {
          y: {
            beginAtZero: true,
            display: false,
            grid: {
              display: false,
            },
          },
          x: {
            grid: {
              display: false,
            },
          },
        },
      },
    });

    myChart.destroy();
  </script>
  {% endblock %}
</div>
{%endblock%}
